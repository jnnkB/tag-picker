/*!
 * ==========================================================
 *  TAG PICKER PLUGIN 3.0.3
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
!function(t,n,e){function r(t,n){var e=n[M](t);return 0>e?null:e}function u(t,n){return t[O].remove(n)}function i(t,n){return t[O].add(n)}function o(t){return Object.keys(t).length}function a(t,n){return Object.assign(t,n)}function f(t,n){return n[M](t)>=0}function c(t){return"function"==typeof t}function s(t){return"number"==typeof t}function l(t){return void 0!==t}function v(t){return"string"==typeof t}function g(t){p(t)&&t[D][z](t)}function p(t){return t&&t[D]}function b(t,e,r){var u,i,o=v(t)?n[_](t):t;if((e||""===e)&&(o[H]=e),r)for(u in r)i=r[u],null===i||!1===i?o[K](u):o[q](u,i);return o}var d="Arrow",$=d+"Left",m=d+"Right",h="Backspace",y="Delete",x="Enter",w="Tab",S="appendChild",j="children",O="classList",E="concat",_="createElement",T="ctrlKey",k="firstChild",R="forEach",L="getAttribute",M="indexOf",H="innerHTML",A="insertBefore",N="__instance__",C="key",X=C+"Code",Y="nextSibling",B="nodeName",D="parentNode",I="previousSibling",K="removeAttribute",z="removeChild",P="replace",q="setAttribute",F="shiftKey",G="textContent",J="toLowerCase",Q=setTimeout;!function(n){n.version="3.0.3",n[N]={},n.each=function(t,e){var r,u;return Q(function(){u=n[N];for(r in u)t.call(u[r],r)},0===e?0:e||1),n},n.I={"Maximum tags allowed is %d":"Maximum tags allowed is %d.","Minimum tags allowed is %d":"Minimum tags allowed is %d.","Remove tag %s":"Remove tag “%s”","Tag %s already exists":"Tag “%s” already exists."},n.i=function(n,r){return n=t[e].I[n]||n,r&&r[R](function(t){n=n.replace("%"+(s(t)?"d":"s"),t)}),n},n._=n.prototype}(t[e]=function(n,p){function d(t,n,e){return l(Tn[t])||(Tn[t]={}),l(e)||(e=o(Tn[t])),Tn[t][e]=n,wn}function O(t,n){return l(t)?l(n)?(delete Tn[t][n],wn):(Tn[t]={},wn):(Tn={},wn)}function _(t,n,e){if(!l(Tn[t]))return wn;if(l(e))l(Tn[t][e])&&Tn[t][e].apply(wn,n);else for(var r in Tn[t])Tn[t][r].apply(wn,n);return wn}function M(t){return wn.f(t)[P](RegExp("("+kn.escape.join("|")[P](/\\/g,"\\\\")+")+"),"").trim()}function K(t){var n,e=M(Hn[G]);e&&(pn(e)?t&&cn("Tag %s already exists",[e]):($n(e),dn(e),n=wn.tags.length,_("change",[e,n]),_("set.tag",[e,n])),sn(""))}function z(){K(1),u(Rn,"focus"),u(Rn,"focus.input"),_("blur",[xn,wn.tags.length])}function q(){_("click",[wn.tags])}function U(){i(Rn,"focus"),i(Rn,"focus.input"),_("focus",[wn.tags])}function V(t){var n,e=kn.escape,r=t[X],i=t[C],o=t[T],a=x===i||13===r,c=t[F],s=w===i||9===r,l=Mn[I],v=wn.tags.length,g=kn.max,p=M(Hn[G]);a?i="\n":s&&(i="	"),f(i,e)||f(r,e)?(g>v?K(1):(sn(""),cn("Maximum tags allowed is %d",[g])),gn(t)):a?(Z()&&_n&&_n.submit(),gn(t)):!c&&s||Q(function(){var a=Hn[G],s=M(a);f(a.slice(-1),e)?(g>v?K(1):(sn(""),cn("Maximum tags allowed is %d",[g])),gn(t)):""!==s||o||c||(""!==p||h!==i&&8!==r?($===i||37===r)&&l&&l.focus():(n=wn.tags[v-1],u(Rn,"focus.tag"),mn(n),bn(n),l&&(_("change",[n,v-1]),_("let.tag",[n,v-1])))),An[H]=s?"":jn},1)}function W(t){if(Rn[D])for(var e;e=Mn[I];)mn(e.title);for(wn.tags=[],n.value="",t=t?t.split(kn.join):[],yn=kn.max,xn,hn=0;yn>hn&&t[hn];++hn)if(""!==(xn=M(t[hn]))){if(pn(xn))continue;$n(xn),dn(xn),_("change",[xn,hn]),_("set.tag",[xn,hn])}}function Z(t){var n=kn.min;return K(),n>0&&wn.tags.length<n?(sn("",1),cn("Minimum tags allowed is %d",[n]),gn(t),!1):!0}function tn(){Q(function(){W(Hn[G]),sn("")},1)}function nn(t){t&&Rn===t.target&&(Hn.focus(),q())}function en(){Hn.focus()}function rn(){var t=this,n=t.title;u(Rn,"focus"),u(Rn,"focus.tag"),_("blur.tag",[n,r(n,wn.tags)])}function un(){var t=this.title;_("click.tag",[t,r(t,wn.tags)])}function on(){var t=this,n=t.title;i(Rn,"focus"),i(Rn,"focus.tag"),_("focus.tag",[n,r(n,wn.tags)])}function an(t){var n=this[D].title;mn(n),bn(n),sn("",1),gn(t)}function fn(t){var n=this,e=t[X],i=t[C],o=(t[T],t[F]),a=w===i||9===e,f=n[I],c=n[Y];if(o&&a||$===i||37===e)f&&(f.focus(),gn(t));else if(a||m===i||39===e)c&&c!==Mn?c.focus():sn("",1),gn(t);else if(h===i||y===i||8===e||46===e){var s=n.title,l=r(s,wn.tags);u(Rn,"focus.tag"),mn(s),bn(s),h===i||8===e?f?f.focus():sn("",1):c&&c!==Mn?c.focus():sn("",1),_("change",[s,l]),_("let.tag",[s,l]),gn(t)}}function cn(t,n){var e,r=kn.alert;!0===r&&(e=Sn.i(t,n))?alert(e):c(r)?r.apply(wn,n):v(r)&&Sn[r]&&Sn[r].apply(wn,n)}function sn(t,n){Hn[G]=t,An[G]=t?"":jn,n&&Hn.focus()}function ln(t,n,e){t.removeEventListener(n,e)}function vn(t,n,e){t.addEventListener(n,e,!1)}function gn(t){t&&t.preventDefault()}function pn(t,n){var e=r(t,wn.tags);return n&&_("get.tag",[t,e]),s(e)?t:null}function bn(t){var e=r(t,wn.tags);return s(e)&&e>=0?(wn.tags.splice(e,1),n.value=wn.tags.join(kn.join),!0):!1}function dn(t,e){s(e)?(e=0>e?0:e,wn.tags=wn.tags.splice(0,e)[E]([t])[E](wn.tags.splice(e-1))):wn.tags.push(t),n.value=wn.tags.join(kn.join)}function $n(t,n){var e=b("span",0,{"class":"tag",tabindex:"0",title:t});if(kn.x){var r=b("a",0,{href:"",title:Sn.i("Remove tag %s",[t])});vn(r,"click",an),e[S](r)}vn(e,"blur",rn),vn(e,"click",un),vn(e,"focus",on),vn(e,"keydown",fn),Ln[D]&&(s(n)&&wn.tags[n]?Ln[A](e,Ln[j][n]):Ln[A](e,Mn))}function mn(t){var n,e=r(t,wn.tags);if(s(e)&&e>=0&&(n=Ln.children[e])){if(ln(n,"blur",rn),ln(n,"click",un),ln(n,"focus",on),ln(n,"keydown",fn),kn.x){var u=n[k];ln(u,"click",an),g(u)}return g(n),!0}return!1}if(n){var hn,yn,xn,wn=this,Sn=t[e],jn=n.placeholder||"",On=n[L]("tabindex"),En={alert:!0,"class":"tag-picker",escape:[",",188],join:", ",max:9999,min:0,x:!1};if(n[e])return wn;if(!(wn instanceof Sn))return new Sn(n,p);Sn[N][n.id||n.name||o(Sn[N])]=wn,n[e]=1,v(p)&&(p={join:p});var _n,Tn={},kn=a(En,p),Rn=b("span",0,{"class":kn["class"]}),Ln=b("span",0,{"class":"tags"}),Mn=b("span",0,{"class":"editor tag"}),Hn=b("span",0,{contenteditable:"true",spellcheck:"false",style:"white-space:pre;"}),An=b("span");for(wn.f=function(t){return t[J]()[P](/[^ a-z0-9-]/g,"")},sn(""),i(n,kn["class"]+"-source"),n[D][A](Rn,n),Rn[S](Ln),Ln[S](Mn),Mn[S](Hn),Mn[S](An),b(n,0,{tabindex:"-1"}),_n=n[D];_n&&_n[B]&&"form"!==_n[B][J]();)_n=_n[D];vn(Hn,"blur",z),vn(Hn,"click",q),vn(Hn,"focus",U),vn(Hn,"keydown",V),vn(Hn,"paste",tn),vn(n,"focus",en),vn(Rn,"click",nn),_n&&vn(_n,"submit",Z),wn.tags=[],W(n.value),wn.input=Hn,wn.self=wn.view=Rn,wn.source=wn.output=n,wn.state=kn,wn.blur=function(){return Hn.blur(),z(),wn},wn.click=function(){return Rn.click(),nn(),wn},wn.fire=function(t,n,e){return _(t,n,e)},wn.focus=function(){return Hn.focus(),U(),wn},wn.get=function(t){return pn(t,1),wn},wn.let=function(t,n){var e=kn.min;return K(),n&&e>0&&wn.tags.length<e?(cn("Minimum tags allowed is %d",[e]),wn):(mn(t),bn(t),wn)},wn.on=function(t,n,e){return d(t,n,e)},wn.off=function(t,n){return O(t,n)},wn.pop=function(){return n[e]?(delete n[e],ln(Hn,"blur",z),ln(Hn,"click",q),ln(Hn,"focus",U),ln(Hn,"keydown",V),ln(Hn,"paste",tn),ln(n,"focus",en),ln(Rn,"click",nn),_n&&ln(_n,"submit",Z),wn.tags[R](mn),u(n,kn["class"]+"-source"),b(n,0,{tabindex:On}),g(Rn),_("pop")):wn},wn.set=function(t,n,e){if(pn(t))e&&cn("Tag %s already exists",[t]);else{var r=kn.max;wn.tags.length<r?($n(t,n),dn(t,n)):e&&cn("Maximum tags allowed is %d",[r])}return wn},wn.value=function(t){return W(t),wn}}})}(window,document,"TP");