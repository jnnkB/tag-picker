/*!
 * ==========================================================
 *  TAG PICKER PLUGIN 3.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
!function(t,n,e){function i(t,n){var e=n[D](t);return 0>e?null:e}function c(t,e,i){var c,r,u=g(t)?n[C](t):t;if((e||""===e)&&(u[S]=e),i)for(c in i)r=i[c],null===r||!1===r?u[z](c):u[P](c,r);return u}function r(t,n){return t[x].remove(n)}function u(t,n){return t[x].add(n)}function o(t,n){return Object.assign(t,n)}function a(t,n){return n[D](t)>=0}function s(t){return"function"==typeof t}function f(t){return"number"==typeof t}function l(t){return void 0!==t}function g(t){return"string"==typeof t}function p(t){return Object.keys(t).length}var v="Arrow",d=v+"Left",h=v+"Right",m="Backspace",k="Delete",b="Enter",y="Tab",j="appendChild",w="children",x="classList",C="createElement",E="forEach",L="fromCharCode",D="indexOf",S="innerHTML",T="insertBefore",_="__instance__",A="key",O=A+"Code",B="nextSibling",I="nodeName",N="parentNode",R="previousSibling",z="removeAttribute",H="removeChild",M="replace",P="setAttribute",$="textContent",q="toLowerCase",F=setTimeout;!function(n){n.version="3.0.0",n[_]={},n.each=function(t,e){return F(function(){var e,i=n[_];for(e in i)t.call(i[e],e,i)},0===e?0:e||1),n},n.I={"Duplicate tag name: %s":"Duplicate tag name: “%s”"},n.i=function(n,i){return n=t[e].I[n]||n,i&&i.forEach(function(t){n=n.replace("%s",t)}),n}}(t[e]=function(n,v){function x(t,n,e){return l(kn[t])||(kn[t]={}),l(e)||(e=p(kn[t])),kn[t][e]=n,vn}function C(t,n){return l(t)?l(n)?(delete kn[t][n],vn):(kn[t]={},vn):(kn={},vn)}function D(t,n,e){if(!l(kn[t]))return vn;if(l(e))l(kn[t][e])&&kn[t][e].apply(vn,n);else for(var i in kn[t])kn[t][i].apply(vn,n);return vn}function z(t){return vn.f(t)[M](RegExp("["+bn.escape.join("")[M](/\\/g,"\\\\")+"]+$"),"").trim()}function P(){var t=z(xn[$]);t&&(un(t)||(sn(t),an(t)),nn("")),r(yn,"focus"),D("blur",[t,vn.tags.length])}function G(){D("click",[vn.tags])}function J(){u(yn,"focus"),D("focus",[vn.tags])}function K(t){var n,e=bn.escape,i=this,c=t[O],r=t[A]||String[L](c),u=wn[R],o=vn.tags.length,s=bn.max;if(b===r?r="\n":y===r&&(r="	"),"\n"!==r&&13!==c||a(r,e))if("	"===r||9===c);else{var f=z(xn[$]);F(function(){var i=xn[$],l=z(i);a(i,e)?nn(""):""===l?""!==f||m!==r&&8!==c?(d===r||37===c)&&u&&u.focus():(n=vn.tags[o-1],fn(n),on(n),D("let.tag",[n,o-1])):a(r,e)&&(n=l,nn(l=""),""!==n&&s>o&&(un(n)?tn(n):(sn(n),an(n),D("set.tag",[n,o]))),rn(t)),Cn[S]=l?"":hn},0)}else{for(var l=i[N];l&&l[I]&&"form"!==l[I][q]();)l=l[N];P(),l&&l.submit(),rn(t)}}function Q(t){var e;if(yn[N])for(;e=wn[R];)fn(e.title);for(vn.tags=[],n.value="",t=t?t.split(bn.join):[],gn=bn.max,pn,ln=0;gn>ln&&t[ln];++ln)if(""!==(pn=z(t[ln]))){if(un(pn))continue;sn(pn),an(pn),D("set.tag",[pn,ln])}return vn}function U(){F(function(){Q(xn[$]),nn("")},0)}function V(t){t&&yn===t.target&&(xn.focus(),G())}function W(){xn.focus()}function X(){var t=this.title;D("click.tag",[t,i(t,vn.tags)])}function Y(){var t=this.title;D("focus.tag",[t,i(t,vn.tags)])}function Z(t){var n=this,e=t[O],c=t[A]||String[L](e),r=n[R],u=n[B];if(d===c||37===e)r&&r.focus();else if(h===c||39===e)u&&u!==wn?u.focus():nn("",1);else if(m===c||k===c||8===e||46===e){var o=n.title,a=i(o,vn.tags);fn(o),on(o),m===c||8===e?r?r.focus():nn("",1):u&&u!==wn?u.focus():nn("",1),D("let.tag",[o,a])}rn(t)}function tn(t){var n=bn.alert;!0===n?alert(dn.i("Duplicate tag name: %s",[t])):s(n)?n.apply(vn,[t]):g(n)&&dn[n]&&dn[n].apply(vn,[t])}function nn(t,n){xn[$]=t,Cn[$]=t?"":hn,n&&xn.focus()}function en(t,n,e){t.removeEventListener(n,e)}function cn(t,n,e){t.addEventListener(n,e,!1)}function rn(t){t.preventDefault()}function un(t,n){var e=i(t,vn.tags);return n&&D("get.tag",[t,e]),f(e)?t:null}function on(t){var e=i(t,vn.tags);return f(e)&&e>=0?(vn.tags.splice(e,1),n.value=vn.tags.join(bn.join),!0):!1}function an(t,e){f(e)?(e=0>e?0:e,vn.tags=vn.tags.splice(0,e).concat([t]).concat(vn.tags.splice(e-1))):vn.tags.push(t),n.value=vn.tags.join(bn.join)}function sn(t,n){var e=c("span","",{"class":"tag",tabindex:"1",title:t});cn(e,"click",X),cn(e,"focus",Y),cn(e,"keydown",Z),jn[N]&&(f(n)&&vn.tags[n]?jn[T](e,jn[w][n]):jn[T](e,wn))}function fn(t){var n,e=i(t,vn.tags);return f(e)&&e>=0&&(n=jn.children[e])?(en(n,"click",X),en(n,"focus",Y),en(n,"keydown",Z),jn[H](n),!0):!1}if(n){var ln,gn,pn,vn=this,dn=t[e],hn=n.placeholder||"",mn={alert:!0,"class":"tag-picker",escape:[","],join:", ",max:9999};if(n[e])return vn;if(!(vn instanceof dn))return new dn(n,v);dn[_][n.id||n.name||p(dn[_])]=vn,n[e]=1,g(v)&&(v={join:v});var kn={},bn=o(mn,v),yn=c("span","",{"class":bn["class"]}),jn=c("span","",{"class":"tags"}),wn=c("span","",{"class":"editor tag"}),xn=c("span","",{contenteditable:"true",spellcheck:"false",style:"white-space:pre;"}),Cn=c("span");vn.f=function(t){return t[q]()[M](/[^ a-z0-9-]/g,"")},nn(""),u(n,bn["class"]+"-source"),n[N][T](yn,n),yn[j](jn),jn[j](wn),wn[j](xn),wn[j](Cn),cn(xn,"blur",P),cn(xn,"click",G),cn(xn,"focus",J),cn(xn,"keydown",K),cn(xn,"paste",U),cn(n,"focus",W),cn(yn,"click",V),vn.tags=[],Q(n.value),vn.input=xn,vn.self=vn.view=yn,vn.source=vn.output=n,vn.state=bn,vn.blur=function(){xn.blur(),P()},vn.click=function(){yn.click(),V()},vn.eject=function(){return n[e]?(delete n[e],en(xn,"blur",P),en(xn,"click",G),en(xn,"focus",J),en(xn,"keydown",K),en(xn,"paste",U),en(n,"focus",W),en(yn,"click",V),vn.tags[E](fn),yn[N][H](yn),r(n,bn["class"]+"-source"),D("eject")):vn},vn.fire=function(t,n,e){return D(t,n,e)},vn.focus=function(){xn.focus(),J()},vn.get=function(t){return un(t,1)},vn.let=function(t){return fn(t),on(t),vn},vn.on=function(t,n,e){return x(t,n,e)},vn.off=function(t,n){return C(t,n)},vn.set=function(t,n,e){return un(t)?e&&tn(t):(sn(t,n),an(t,n)),vn},vn.value=function(t){return Q(t)}}})}(window,document,"TP");