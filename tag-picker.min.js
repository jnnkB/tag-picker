/*!
 * ==========================================================
 *  TAG PICKER PLUGIN 3.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
!function(t,n,e){function r(t,n){var e=n.indexOf(t);return 0>e?null:e}function o(t,e,r){var o,a,i=f(t)?n.createElement(t):t;if((e||""===e)&&(i.innerHTML=e),r)for(o in r)a=r[o],null===a||!1===a?i.removeAttribute(o):i.setAttribute(o,a);return i}function a(t,n){return Object.assign(t,n)}function i(t,n){return n.indexOf(t)>=0}function c(t){return"function"==typeof t}function s(t){return"number"==typeof t}function u(t){return void 0!==t}function f(t){return"string"==typeof t}function l(t){return Object.keys(t).length}var p="__instance__",g=setTimeout;!function(n){n.version="3.0.0",n[p]={},n.each=function(t,e){return g(function(){var e,r=n[p];for(e in r)t.call(r[e],e,r)},0===e?0:e||1),n},n.I={"Duplicate tag name: %s":"Duplicate tag name: “%s”"},n.i=function(n,r){return n=t[e].I[n]||n,r&&r.forEach(function(t){n=n.replace("%s",t)}),n}}(t[e]=function(n,d){function v(t,n){return u(t)?u(n)?K[t][n]||null:K[t]||{}:K}function h(t,n,e){return u(K[t])||(K[t]={}),u(e)||(e=l(K[t])),K[t][e]=n,q}function k(t,n){return u(t)?u(n)?(delete K[t][n],q):(K[t]={},q):(K={},q)}function b(t,n,e){if(!u(K[t]))return q;if(u(e))u(K[t][e])&&K[t][e].apply(q,n);else for(var r in K[t])K[t][r].apply(q,n);return q}function m(t,n,e){return u(t)?u(n)&&null!==n&&!1!==n?h(t,n,e):k(t,n,e):K}function w(t){return q.f(t).replace(RegExp("["+Q.escape.join("").replace(/\\/g,"\\\\")+"]+$"),"").trim()}function y(){var t=w(X.textContent);t&&(z(t),P(t),S("")),b("tags.blur",[t,q.tags.length])}function x(){b("tags.click",[q.tags])}function C(){b("tags.focus",[q.tags])}function j(t){var n,e,r=Q.escape,o=t.key.toLowerCase(),e=W.previousSibling,a=q.tags.length,c=Q.max;if(o={enter:"\n",tab:"	"}[o]||o,"\n"!==o||i(o,r))if("	"===o);else{var s=w(X.textContent);g(function(){var u=X.textContent,f=w(u);i(u,r)?S(""):""===f?""===s&&"backspace"===o?(n=q.tags[a-1],R(n),M(n),b("tag.let",[n,a-1])):"arrowleft"===o&&e&&e.focus():i(o,r)&&(n=f,S(f=""),""!==n&&c>a&&(I(n)?B(n):(P(n),z(n),b("tag.set",[n,a]))),D(t)),Y.innerHTML=f?"":G},0)}else{for(var u=this.parentNode;u&&u.nodeName&&"form"!==u.nodeName.toLowerCase();)u=u.parentNode;u&&u.submit(),D(t)}}function L(){g(function(){for(var t,n=X.textContent.split(Q.join),e=Q.max,r=0;e>r&&n[r];++r)""!==(t=w(n[r]))&&(z(t),P(t),b("tag.set",[t,r]));S("")},0)}function N(t){U===t.target&&(X.focus(),x())}function E(){X.focus()}function D(t){t.preventDefault()}function O(){var t=this.title;b("tag.click",[t,r(t,q.tags)])}function T(){var t=this.title;b("tag.focus",[t,r(t,q.tags)])}function _(t){var n=this,e=t.key.toLowerCase(),o=n.previousSibling,a=n.nextSibling;if("arrowleft"===e)o&&o.focus();else if("arrowright"===e)a&&a!==W?a.focus():S("",1);else if("backspace"===e||"delete"===e){var i=n.title,c=r(i,q.tags);R(i),M(i),"backspace"===e?o?o.focus():S("",1):a&&a!==W?a.focus():S("",1),b("tag.let",[i,c])}D(t)}function B(n){var e=Q.alert;!0===e?alert(F.i("Duplicate tag name: %s",[n])):c(e)?e.apply(q,[n]):f(e)&&t[e]&&t[e].apply(q,[n])}function S(t,n){X.textContent=t,Y.textContent=t?"":G,n&&X.focus()}function A(t,n,e){t.removeEventListener(n,e)}function H(t,n,e){t.addEventListener(n,e,!1)}function I(t){var n=r(t,q.tags);return b("tag.get",[t,n]),s(n)?t:null}function M(t){var e=r(t,q.tags);return 0>e?!1:(q.tags.splice(e,1),n.value=q.tags.join(Q.join),!0)}function z(t,e){s(e)?(e=0>e?0:e,q.tags=q.tags.splice(0,e).concat(t).concat(q.tags.splice(e))):q.tags.push(t),n.value=q.tags.join(Q.join)}function P(t,n){var e=o("span","",{"class":"tag",draggable:!0,tabindex:1,title:t});H(e,"click",O),H(e,"focus",T),H(e,"keydown",_),s(n)?V.insertBefore(e,V.children[n]):V.insertBefore(e,W)}function R(t){var n,e=r(t,q.tags);return e>=0&&(n=V.children[e])?(A(n,"click",O),A(n,"focus",T),A(n,"keydown",_),V.removeChild(n),!0):!1}function $(){return!!U.parentNode}if(n){var q=this,F=t[e],G=n.placeholder||"",J={alert:!0,"class":"tag-picker",escape:[","],join:", ",max:9999};if(!(q instanceof F))return new F(n,d);F[p][n.id||n.name||l(F[p])]=q,f(d)&&(d={join:d});var K={},Q=a(J,d),U=o("span","",{"class":Q["class"]}),V=o("span","",{"class":"tags"}),W=o("span",'<span contenteditable spellcheck="false" style="white-space:pre;"></span><span></span>',{"class":"editor tag"}),X=W.children[0],Y=W.children[1];return q.f=function(t){return t.toLowerCase().replace(/[^ a-z0-9-]/g,"")},H(X,"blur",y),H(X,"click",x),H(X,"focus",C),H(X,"keydown",j),H(X,"paste",L),H(n,"focus",E),H(U,"click",N),S(""),n.classList.add(Q["class"]+"-source"),n.parentNode.insertBefore(U,n),U.appendChild(V),V.appendChild(W),q.tags=[],X.textContent=n.value,L(),q.input=X,q.self=q.view=U,q.source=q.output=n,q.state=Q,q.blur=function(){X.blur(),y()},q.click=function(){U.click(),N()},q.focus=function(){X.focus(),C()},q.get=function(t){return I(t)},q.hook=m,q.hook.get=v,q.hook.let=k,q.hook.set=h,q.hook.fire=b,q.let=function(t){return R(t),M(t),q},q.set=function(t,n,e){return I(t)?e&&B(t):(P(t,n),z(t,n)),q},q.create=function(t){return $()?q:new F(q.source,t)},q.destroy=function(){return $()?(A(X,"blur",y),A(X,"click",x),A(X,"focus",C),A(X,"keydown",j),A(X,"paste",L),A(n,"focus",E),A(U,"click",N),q.tags.forEach(function(t){R(t)}),U.parentNode.removeChild(U),n.classList.remove(Q["class"]+"-source"),b("tags.let")):q},b("tags.set")}})}(window,document,"TP");